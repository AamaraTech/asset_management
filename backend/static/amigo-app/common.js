"use strict";(self.webpackChunkwm_ui_web_app=self.webpackChunkwm_ui_web_app||[]).push([["common"],{9958:(S,g,s)=>{s.d(g,{c:()=>w});var u=s(4438),m=s(6344),r=s(9417),e=s(4957),v=s(8838),n=s(9673),o=s(9389),d=s(8187);class h extends d.L{constructor(a){super(a),this.translate=a,this.poDropDownData=(0,u.vPA)(null),this.vendorDropDownData=(0,u.vPA)(null),this.sourceDropdownOptions=(0,u.vPA)([{key:"direct",value:"Direct"},{key:"purchase_order",value:"Purchase Order"}]),this.isPoDropDownVisible=(0,u.vPA)(!1)}createForm(a){return this.newGrnForm()}formatCurrency(a){return a.toLocaleString("en-US",{style:"currency",currency:"USD"})}getTableData(a=[]){return new v.O(this.translate,e.z.grn_items).columnSchema(this.getTableColumnSchema()).formInitialise(new n.h).formSchema(this.getTableFormSchema()).getDatasource("id",a).enableFooter(!0).setTableCaption(!0).setTableCaptionDialogButton(!0).setTableCaptionDialogButtonLabel("Add Asset").setExportTableData(!0).setField(this.getTableOverlayFiled()).build()}getTableOverlayFiled(){return(new v.a).setTableName("grn_items").setOverlayPanelColumnSchema([{name:"Asset Name"},{name:"Asset Code"}]).setOnUpdateRows(this.updateTableRows.bind(this)).setOverlayPanelSelectionMode("single").setOverlayPanelRows(10).setDialogScrollHeight("55vh").setOverlayPanelFormInitialise(["asset_name","asset_code"]).setOverlayPanelPaginator(!0).setScrollable(!0).setLazy(!0).setFontSize("14px").setQueryParams({}).setDisabledField("false").setUrls(o.q.ASSET).build()}getTableColumnSchema(){return[e.S.asset+"_TC","asset_code_TC","asset_description_TC","asset_serial_number_TC",e.S.hs_code+"_TC",e.S.uom+"_TC",e.S.po_qty+"_TC",e.S.received_qty+"_TC",e.S.unit_price+"_TC",e.S.discount+"_TC",e.S.discount_amount+"_TC",e.S.tax+"_TC",e.S.tax_amount+"_TC",e.S.sub_total+"_TC",e.S.total_amount+"_TC",e.S.reject_qty+"_TC",e.S.accepted_qty+"_TC",e.S.balance_qty+"_TC",e.S.trc_number+"_TC",e.S.remarks+"_TC"]}getTableFormSchema(){let a={name:"asset_serial_number",type:"dropdown",dialogue:!0,label:"test",dialogueLabel:"Enter Serial Number",emptyCustomDialogTemplate:!0,emptyComment:"",placeholder:this.translate.instant("enter_Serial_Number_TC",{label:this.translate.instant("enter_Serial_Number_TC")}),options:[{productName:"Vishnu",id:"vishnu"}],optionLabel:"productName",optionValue:"id",dialogueWidth:"80vw",dialogueHeight:"80vh",saveDialogueData:this.onSaveBarCodeEntry.bind(this),dialogueFields:[]};return[this.createTableInputField("asset","input"),this.createTableInputField("asset_code","input"),this.createTableInputField("asset_description","input"),this.createDropdownField(a),this.createTableInputField(e.S.hs_code,"input"),this.createTableInputField(e.S.uom,"input"),this.createTableInputField(e.S.po_qty,"input","quantity"),this.createTableInputField(e.S.received_qty,"input","quantity"),this.createTableInputField(e.S.unit_price,"input","quantity"),this.createTableInputField(e.S.discount,"input","quantity",this.onDiscountChange.bind(this)),this.createTableInputField(e.S.discount_amount,"input","quantity"),this.createTableInputField(e.S.tax,"input","quantity",this.calculateTaxAmount.bind(this)),this.createTableInputField(e.S.tax_amount,"input","quantity"),this.createTableInputField(e.S.sub_total,"input","quantity"),this.createTableInputField(e.S.total_amount,"input","quantity"),this.createTableInputField(e.S.reject_qty,"input","quantity"),this.createTableInputField(e.S.accepted_qty,"input","quantity"),this.createTableInputField(e.S.balance_qty,"input","quantity"),this.createTableInputField(e.S.trc_number,"input","quantity"),this.createTableInputField(e.S.remarks,"input","quantity")]}updateTableRows(a){return a.map(t=>{let i=new n.h;return i.asset=t.id,i.asset_code=t.asset_code,i.asset_description=t.asset_description,i.asset_serial_number=t.asset_serial_number,i.hs_code=t.asset_hs_code,i})}onDiscountChange(a,t){const i=+t.received_qty,l=+t.unit_price,_=this.calculateDiscountAmount(i,l,+t.discount);return t[e.S.discount_amount]=_,t[e.S.sub_total]=i*l-_,t}onTaxChange(a,t){const _=this.calculateDiscountAmount(+t.received_qty,+t.unit_price,+t.tax);return t[e.S.tax_amount]=_,t}calculateDiscountAmount(a,t,i){return t*a*i/100}calculateTaxAmount(a,t){return t[e.S.tax_amount]=+t.sub_total*+t.tax/100,t[e.S.total_amount]=t[e.S.sub_total]+t[e.S.tax_amount],t}onSaveBarCodeEntry(a,t,i){let l=a?.get(i);if(l?.length){let p=l.map(_=>_.code).join(",");t?.grn_items?.length&&(t.grn_items[i].asset_serial_number=p)}else t.grn_items[i].asset_serial_number=l;return t}poDropdownHandler(a,t,i){this.form.get(e.z.vendor).disable()}getDefaultData(a,t){t.get(e.z.grn_no).setValue(a.grn_no),t.get(e.z.grn_date).setValue(a.grn_date),t.get(e.z.source).setValue(a.source),t.get(e.z.vendor_bill).setValue(a.vendor_bill),t.get(e.z.vendor_bill_date).setValue(a.vendor_bill_date),t.get(e.z.vendor_address).setValue(a.vendor_address),t.get(e.z.vendor).setValue(a.vendor),t.get(e.z.other_ref_no).setValue(a.other_ref_no),t.get(e.z.note).setValue(a.note),t.get(e.z.batch_no).setValue(a.batch_no),t.get(e.z.arrive_date).setValue(a.arrive_date),t.get(e.z.exit_date).setValue(a.exit_date),t.get(e.z.vehicle_no).setValue(a.vehicle_no),t.get(e.z.remarks).setValue(a.remarks),t.get(e.z.grn_items).setValue(a.grn_items)}sourceDropdownChangeHandler(a,t,i){}vendorDropdownHandler(a,t,i){}getFormFields(){return{[e.z.grn_no]:this.getInputField(e.z.grn_no,new n.$),[e.z.source]:this.getDropDownField(e.z.source,new n.$,this.sourceDropdownChangeHandler.bind(this),this.sourceDropdownOptions),[e.z.purchase_order]:this.getDropDownField(e.z.purchase_order,new n.$,this.poDropdownHandler.bind(this),this.poDropDownData),[e.z.grn_date]:this.getDateField(e.z.grn_date,new n.$),[e.z.vendor]:this.getDropDownField(e.z.vendor,new n.$,this.vendorDropdownHandler.bind(this),this.vendorDropDownData),[e.z.vendor_bill]:this.getInputField(e.z.vendor_bill,new n.$),[e.z.vendor_bill_date]:this.getDateField(e.z.vendor_bill_date,new n.$),[e.z.vendor_address]:this.getInputField(e.z.vendor_address,new n.$),[e.z.other_ref_no]:this.getInputField(e.z.other_ref_no,new n.$),[e.z.batch_no]:this.getInputField(e.z.batch_no,new n.$),[e.z.note]:this.getInputField(e.z.note,new n.$),[e.z.vehicle_no]:this.getInputField(e.z.vehicle_no,new n.$),[e.z.arrive_date]:this.getInputField(e.z.arrive_date,new n.$),[e.z.exit_date]:this.getInputField(e.z.exit_date,new n.$),[e.z.remarks]:this.getInputField(e.z.remarks,new n.$)}}newGrnForm(){return new r.gE({[e.z.grn_no]:new r.MJ,[e.z.grn_date]:new r.MJ(null,{validators:[r.k0.required]}),[e.z.source]:new r.MJ(null,{validators:[r.k0.required]}),[e.z.vendor_bill]:new r.MJ,[e.z.vendor_bill_date]:new r.MJ,[e.z.vendor_address]:new r.MJ,[e.z.vendor]:new r.MJ(null,{validators:[r.k0.required]}),[e.z.other_ref_no]:new r.MJ,[e.z.note]:new r.MJ,[e.z.batch_no]:new r.MJ,[e.z.arrive_date]:new r.MJ,[e.z.exit_date]:new r.MJ,[e.z.vehicle_no]:new r.MJ,[e.z.remarks]:new r.MJ,[e.z.grn_items]:new r.MJ})}}var b=s(6294),D=s(5558),T=s(7673),F=s(4842);let w=(()=>{class c extends h{constructor(t){super(t),this.translateService=t,this.apiService=(0,u.WQX)(m.G),this.router=(0,u.WQX)(b.Ix),this.activatedRoute=(0,u.WQX)(b.nX),this.params=(0,u.vPA)(null),this.tableField=(0,u.vPA)(null),this.getDropdownData()}getGrnData(t){return this.activatedRoute.params.pipe((0,D.n)(i=>(this.params.set(i),this.apiService.get(`${o.q.GOODS_RECEIVED_NOTE}${i?.id}/`))),(0,D.n)(i=>(this.getDefaultData(i,t),this.tableField.set(this.getTableData(i.grn_items)),(0,T.of)(this.getTableFeilds))))}getNewTableData(){return this.tableField.set(this.getTableData()),this.tableField()}getTableFeilds(){return this.tableField()}getDropdownData(){this.apiService.get(o.q.PURCHASE_ORDER).subscribe(t=>{if(t?.results){let i=t.results.map(l=>({key:l.id,value:l.po_no}));this.poDropDownData.set(i)}}),this.apiService.get(o.q.VENDOR_MASTER).subscribe(t=>{if(t?.results){let i=t.results.map(l=>({key:l.id,value:l.vendor_name}));this.vendorDropDownData.set(i)}})}updateGrnForm(t){this.apiService.put(`${o.q.GOODS_RECEIVED_NOTE}${this.params().id}/`,t).subscribe(i=>{this.router.navigate(["/grn"])})}saveGrn(t){this.apiService.post(`${o.q.GOODS_RECEIVED_NOTE}`,t).subscribe(i=>{this.router.navigate(["/grn"])})}cancel(){this.router.navigate(["/grn"])}static#e=this.\u0275fac=function(i){return new(i||c)(u.KVO(F.c$))};static#t=this.\u0275prov=u.jDH({token:c,factory:c.\u0275fac})}return c})()},8187:(S,g,s)=>{s.d(g,{L:()=>e});var u=s(3398),m=s(6087),r=s(3958);class e{constructor(n){this.translate=n}getInputField(n,o){return new r.F(this.translate,n,!1,null,o).addFieldWidth("32%").variantType("basic").toObject()}getDateField(n,o,d){return new u.v(this.translate,n,!1,null,o).addFieldWidth("32%").validate(!0).variantType("basic").onChange(d.bind(this)).addFormat("yy-mm-dd").toObject()}getDropDownField(n,o,d,h){return new m.i(this.translate,n,!1,null,o).addFieldWidth("32%").addKeyValueLabel("value","key").onChange(d.bind(this)).getOptions(h).variantType("basic").toObject()}createTableInputField(n,o,d,h){return{name:n,type:o,id:d,onValueChange:h}}createDropdownField(n){return{name:n.name,type:"dropdown",options:n.options,optionLabel:n.optionLabel,optionValue:n.optionValue,dialogue:n.dialogue,label:"test",dialogueLabel:"Enter Serial Number",emptyCustomDialogTemplate:!0,emptyComment:"",placeholder:this.translate.instant("enter_Serial_Number_TC",{label:this.translate.instant("enter_Serial_Number_TC")}),dialogueWidth:n.dialogueWidth,dialogueHeight:n.dialogueHeight,dialogueFields:n.dialogueFields}}}}}]);